<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
</head>
<body>
    <h3>Async SignalR Patterns (<a href="https://github.com/davidfowl/SignalRAsyncPatterns">code</a>)</h3>

    <button id="scenario-1">Get all data</button>
    <button id="scenario-2">Get data and show results as loaded serially</button>
    <button id="scenario-3">Get data and show results in parallel</button>

    <dl>
        <dt><strong>Scenario:</strong> <span id="scenario-title"></span> <span id="scenario-time"></span> </dt>
        <dd>
            <ul id="scenario-results"></ul>
        </dd>
    </dl>

    <script src="Scripts/jquery-1.10.2.js"></script>
    <script src="Scripts/jquery.signalR-2.0.0.js"></script>
    <script src="signalr/hubs"></script>
    <script>
        $(function () {
            function reset() {
                $('#scenario-title').html('');
                $('#scenario-results').html('');
                $('#scenario-time').html('');
            }

            var processor = $.connection.processor;

            processor.client.loadResponse = function (val) {
                $('#scenario-results').append("<li><pre>" + val + "</pre></li>");
            };

            $.connection.hub.start().done(function () {
                $('#scenario-1').click(function () {
                    reset();

                    $('#scenario-title').html($(this).html());

                    var start = new Date();
                    processor.server.getAllData().done(function (results) {
                        $.each(results, function (_, val) {
                            // Reuse the client function
                            processor.client.loadResponse(val);
                        });

                        $('#scenario-time').html((new Date() - start) + "ms");
                    });
                });

                $('#scenario-2').click(function () {
                    reset();

                    $('#scenario-title').html($(this).html());

                    var start = new Date();
                    processor.server.loadDataOnDemand().done(function () {
                        $('#scenario-time').html((new Date() - start) + "ms");
                    }); 
                });

                $('#scenario-3').click(function () {
                    reset();

                    $('#scenario-title').html($(this).html());

                    var start = new Date();
                    processor.server.loadDataOnDemandParallel().done(function () {
                        $('#scenario-time').html((new Date() - start) + "ms");
                    });
                });
            });
        });
    </script>
</body>
</html>
